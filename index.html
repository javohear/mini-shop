<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mini Shop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* --- UMUMIY DIZAYN --- */
        :root {
            --tg-bg: var(--tg-theme-bg-color, #212121);
            --tg-text: var(--tg-theme-text-color, #ffffff);
            --tg-blue: var(--tg-theme-button-color, #3390ec);
            --card-bg: rgba(45, 45, 45, 0.85);
            --input-bg: rgba(58, 58, 58, 0.9);
        }

        body {
            margin: 0; padding: 0;
            background-color: #000;
            color: var(--tg-text);
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
        }

        /* --- VIDEO FON --- */
        .video-bg-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        #bgVideo {
            width: 100%; height: 100%;
            object-fit: cover;
        }

        .video-overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 0;
        }

        /* --- MUTE TUGMASI --- */
        .mute-btn {
            position: fixed;
            bottom: 20px; right: 20px;
            width: 45px; height: 45px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px;
            cursor: pointer;
            z-index: 100;
            backdrop-filter: blur(5px);
            transition: transform 0.2s;
        }
        .mute-btn:active { transform: scale(0.9); }

        /* --- EKRANLAR --- */
        .screen {
            width: 100vw; height: 100vh;
            display: flex; flex-direction: column;
            align-items: center; justify-content: flex-start;
            position: absolute; top: 0; left: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        /* --- CAPTCHA --- */
        #screen-captcha { z-index: 10; justify-content: center; }
        .captcha-container { background-color: var(--card-bg); padding: 20px; border-radius: 16px; width: 90%; max-width: 320px; text-align: center; backdrop-filter: blur(10px); }
        .image-area { position: relative; width: 280px; height: 160px; margin: 0 auto 20px auto; border-radius: 12px; overflow: hidden; }
        .main-image { width: 100%; height: 100%; background-image: url('resources/bg.jpg'); background-size: cover; object-fit: cover; }
        .target-spot { position: absolute; top: 40px; left: 180px; width: 50px; height: 50px; background: rgba(0,0,0,0.5); border: 2px solid rgba(255,255,255,0.2); }
        .puzzle-piece { position: absolute; top: 40px; left: 10px; width: 50px; height: 50px; background-image: url('resources/bg.jpg'); background-size: 280px 160px; background-position: -180px -40px; border: 2px solid var(--tg-blue); z-index: 2; }
        .slider-container { position: relative; width: 280px; height: 50px; background: rgba(33, 33, 33, 0.8); border-radius: 25px; margin: 0 auto; }
        .slider-handle { position: absolute; left: 0; top: 0; width: 50px; height: 50px; background: var(--tg-blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; cursor: grab; touch-action: none; }
        
        /* --- WELCOME --- */
        #screen-welcome { z-index: 9; display: none; justify-content: center; text-align: center; }
        .welcome-text { font-size: 28px; font-weight: bold; color: var(--tg-blue); animation: fadeIn 1s; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- SHOP --- */
        #screen-shop { background-color: transparent; z-index: 5; display: none; padding-top: 20px; overflow-y: auto; height: 100vh; }
        .shop-header { text-align: center; margin-bottom: 20px; font-size: 24px; font-weight: bold; text-shadow: 0 2px 5px rgba(0,0,0,0.5); }
        .grid-container { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 0 15px 80px 15px; width: 100%; box-sizing: border-box; }
        .card { background-color: var(--card-bg); border-radius: 15px; padding: 15px; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: space-between; backdrop-filter: blur(5px); }
        .card img { width: 70px; height: 70px; border-radius: 14px; margin-bottom: 10px; object-fit: cover; }
        .card h3 { font-size: 14px; margin: 5px 0; color: var(--tg-text); }
        .btn-buy { background-color: var(--tg-blue); color: white; border: none; padding: 10px 0; width: 100%; border-radius: 8px; margin-top: 8px; font-weight: bold; cursor: pointer; }

        /* --- DETAIL --- */
        #screen-detail { background-color: var(--tg-bg); z-index: 20; transform: translateX(100%); padding: 20px; box-sizing: border-box; display: flex; overflow-y: auto; height: 100vh; }
        .detail-header { display: flex; align-items: center; width: 100%; margin-bottom: 20px; flex-shrink: 0; }
        .back-btn { background: none; border: none; color: var(--tg-text); font-size: 24px; cursor: pointer; margin-right: 15px; }
        .game-title { font-size: 22px; font-weight: bold; }
        .input-group { width: 100%; margin-bottom: 20px; flex-shrink: 0; }
        .input-label { display: block; margin-bottom: 8px; color: #aaa; font-size: 14px; }
        .input-field { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #444; background-color: var(--input-bg); color: white; font-size: 16px; outline: none; box-sizing: border-box; }
        .input-field:focus { border-color: var(--tg-blue); }
        
        .packages-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; margin-bottom: 15px; flex-shrink: 0; }
        
        .package-btn.full-width { grid-column: span 2; }
        
        /* HEADER STILI */
        .package-header {
            grid-column: span 1; 
            background-color: transparent;
            color: #ffc107;
            font-weight: bold;
            text-align: center;
            padding: 15px 0 5px 0;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            pointer-events: none;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-top: 10px;
            line-height: 1.4;
        }

        .package-btn { background-color: var(--card-bg); border: 2px solid transparent; padding: 15px; border-radius: 12px; color: white; cursor: pointer; text-align: center; }
        .package-btn.active { border-color: var(--tg-blue); background-color: rgba(51, 144, 236, 0.1); }
        .package-price { display: block; font-size: 12px; color: #aaa; margin-top: 5px; }
        .main-action-btn { width: 100%; padding: 15px; background-color: var(--tg-blue); color: white; border: none; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: auto; margin-bottom: 20px; opacity: 0.5; pointer-events: none; transition: opacity 0.3s; flex-shrink: 0; }
        .main-action-btn.active { opacity: 1; pointer-events: all; }

    </style>
</head>
<body>

    <div class="video-bg-container">
        <video id="bgVideo" autoplay loop muted playsinline>
            <source src="resources/bgvideo.mp4" type="video/mp4">
        </video>
        <div class="video-overlay"></div>
    </div>

    <audio id="bgMusic" loop>
        <source src="resources/music.m4a" type="audio/mp4">
    </audio>

    <div class="mute-btn" id="muteBtn" onclick="toggleMute()">üîá</div>

    <div id="screen-captcha" class="screen">
        <h2>Xavfsizlik</h2>
        <p style="color:#ddd; margin-bottom: 20px;">Robot emasligingizni tasdiqlang</p>
        <div class="captcha-container" id="captchaBox">
            <div class="image-area">
                <div class="main-image"></div>
                <div class="target-spot"></div>
                <div class="puzzle-piece" id="piece"></div>
            </div>
            <div class="slider-container" id="sliderContainer">
                <div class="slider-handle" id="handle">‚ûú</div>
            </div>
        </div>
    </div>

    <div id="screen-welcome" class="screen">
        <div class="welcome-text">Do'konga xush kelibsiz! üëã</div>
    </div>

    <div id="screen-shop" class="screen">
        <div class="shop-header">ToWe market</div>
        <div class="grid-container">
            <div class="card">
                <img src="resources/tgprem.jpg" alt="Premium">
                <h3>Telegram Premium</h3>
                <button class="btn-buy" onclick="openDetail('Telegram Premium', 'username')">Tanlash</button>
            </div>
            
            <div class="card">
                <img src="resources/tgstars.jpg" alt="Stars">
                <h3>Telegram Stars</h3>
                <button class="btn-buy" onclick="openDetail('Telegram Stars', 'username')">Tanlash</button>
            </div>

            <div class="card">
                <img src="resources/steamlogo.jpg" alt="Steam">
                <h3>Steam Wallet</h3>
                <button class="btn-buy" onclick="openDetail('Steam Wallet', 'login')">Tanlash</button>
            </div>

            <div class="card">
                <img src="resources/pubglogo.jpg" alt="PUBG">
                <h3>PUBG Mobile</h3>
                <button class="btn-buy" onclick="openDetail('PUBG Mobile', 'id')">Tanlash</button>
            </div>

            <div class="card">
                <img src="resources/tggift.png" alt="Gifts">
                <h3>Telegram Gifts</h3>
                <button class="btn-buy" onclick="openDetail('Telegram Gifts', 'username')">Tanlash</button>
            </div>
        </div>
    </div>

    <div id="screen-detail" class="screen">
        <div class="detail-header">
            <button class="back-btn" onclick="closeDetail()">‚Üê</button>
            <span class="game-title" id="detailTitle">Game Name</span>
        </div>

        <div class="input-group">
            <label class="input-label" id="inputLabel">ID raqamingiz</label>
            <input type="text" class="input-field" id="userIdInput" placeholder="Kiriting...">
        </div>

        <label class="input-label" id="packageLabel">Paketni tanlang:</label>
        <div class="packages-grid" id="packagesContainer"></div>

        <div class="input-group" id="commentGroup" style="display: none; margin-bottom: 15px;">
            <label class="input-label">Sovg'a uchun izohingiz bo'lsa shuyerga yozishingiz mumkinüëáüèª</label>
            <input type="text" class="input-field" id="commentInput" placeholder="Izoh (ixtiyoriy)...">
        </div>

        <div class="input-group" id="anonymousGroup" style="display: none; flex-direction: row; align-items: center; justify-content: space-between; background-color: var(--input-bg); padding: 15px; border-radius: 10px; border: 1px solid #444; margin-bottom: 20px;">
            <label style="color: white; font-size: 16px; margin: 0;">üïµÔ∏è‚Äç‚ôÇÔ∏è Anonim yuborish</label>
            <input type="checkbox" id="anonymousCheckbox" style="width: 20px; height: 20px; accent-color: var(--tg-blue);">
        </div>

        <button class="main-action-btn" id="buyBtn" onclick="sendOrder()">Sotib Olish</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        const screenCaptcha = document.getElementById('screen-captcha');
        const screenWelcome = document.getElementById('screen-welcome');
        const screenShop = document.getElementById('screen-shop');
        const screenDetail = document.getElementById('screen-detail');
        const packageLabel = document.getElementById('packageLabel');
        const muteBtn = document.getElementById('muteBtn');
        const bgMusic = document.getElementById('bgMusic');
        
        // --- VIDEO TEZLIGI (3x) ---
        const bgVideo = document.getElementById('bgVideo');
        bgVideo.playbackRate = 3.0; 

        function toggleMute() {
            if (bgMusic.paused) { bgMusic.play(); muteBtn.innerText = "üîä"; } 
            else { bgMusic.pause(); muteBtn.innerText = "üîá"; }
        }

        // --- CAPTCHA ---
        const handle = document.getElementById('handle');
        const piece = document.getElementById('piece');
        const sliderContainer = document.getElementById('sliderContainer');
        const captchaBox = document.getElementById('captchaBox');
        let isDragging = false; let startX = 0; let currentX = 0;
        const TARGET_POSITION = 170; const TOLERANCE = 10;
        const maxMove = sliderContainer.clientWidth - handle.clientWidth;

        handle.addEventListener('touchstart', startDrag, {passive: false});
        handle.addEventListener('touchmove', doDrag, {passive: false});
        handle.addEventListener('touchend', stopDrag);
        handle.addEventListener('mousedown', startDrag);
        document.addEventListener('mousemove', doDrag);
        document.addEventListener('mouseup', stopDrag);

        function startDrag(e) { if (captchaBox.classList.contains('success')) return; isDragging = true; startX = (e.touches ? e.touches[0].clientX : e.clientX) - currentX; }
        function doDrag(e) { if (!isDragging) return; e.preventDefault(); let clientX = e.touches ? e.touches[0].clientX : e.clientX; let moveX = clientX - startX; if (moveX < 0) moveX = 0; if (moveX > maxMove) moveX = maxMove; currentX = moveX; handle.style.transform = `translateX(${currentX}px)`; piece.style.transform = `translateX(${currentX}px)`; }
        function stopDrag() { if (!isDragging) return; isDragging = false; if (Math.abs(currentX - TARGET_POSITION) <= TOLERANCE) onSuccess(); else { handle.style.transform = `translateX(0px)`; piece.style.transform = `translateX(0px)`; currentX = 0; tg.HapticFeedback.notificationOccurred('error'); } }

        function onSuccess() {
            captchaBox.classList.add('success'); handle.innerHTML = "‚úì"; handle.style.backgroundColor = "#4CAF50"; tg.HapticFeedback.notificationOccurred('success');
            setTimeout(() => { screenCaptcha.style.opacity = '0'; setTimeout(() => { screenCaptcha.style.display = 'none'; screenWelcome.style.display = 'flex'; setTimeout(() => screenWelcome.style.opacity = '1', 50); }, 500); }, 500);
            setTimeout(() => { screenWelcome.style.opacity = '0'; setTimeout(() => { screenWelcome.style.display = 'none'; screenShop.style.display = 'block'; screenShop.style.opacity = '1'; }, 500); }, 2500);
        }

        // --- NARXLAR VA MA'LUMOTLAR ---
        const products = {
            'Telegram Premium': [
                {name: 'üéÅ 3 oylik', price: '170 000'},
                {name: 'üéÅ 6 oylik', price: '225 000'},
                {name: 'üéÅ Yillik', price: '395 000'}
            ],
            
            'Telegram Stars': [
                {name: '‚≠êÔ∏è 50 Stars', price: '15 000'},
                {name: '‚≠êÔ∏è 75 Stars', price: '20 000'},
                {name: '‚≠êÔ∏è 100 Stars', price: '28 000'},
                {name: '‚≠êÔ∏è 150 Stars', price: '37 000'},
                {name: '‚≠êÔ∏è 250 Stars', price: '60 000'},
                {name: '‚≠êÔ∏è 350 Stars', price: '85 000'},
                {name: '‚≠êÔ∏è 500 Stars', price: '115 000'},
                {name: '‚≠êÔ∏è 750 Stars', price: '180 000'},
                {name: '‚≠êÔ∏è 1 000 Stars', price: '235 000', full: true},
                {name: '‚≠êÔ∏è 1 500 Stars', price: '350 000', full: true},
                {name: '‚≠êÔ∏è 2 500 Stars', price: '580 000', full: true},
                {name: '‚≠êÔ∏è 5 000 Stars', price: '1 160 000', full: true},
                {name: '‚≠êÔ∏è 10 000 Stars', price: '2 300 000', full: true}
            ],
            
            'Steam Wallet': [
                {name: 'üìâ 1-10 USD KURSi: 16,000', type: 'header'}, 
                {name: 'üí≤ 1 USD', price: '16 000'},
                {name: 'üí≤ 5 USD', price: '80 000'},
                {name: 'üí≤ 9 USD', price: '144 000'},
                {name: 'üìâ 10-100 USD KURSi: 15,000', type: 'header'},
                {name: 'üí≤ 10 USD', price: '150 000'},
                {name: 'üí≤ 50 USD', price: '750 000'},
                {name: 'üí≤ 99 USD', price: '1 485 000'},
                {name: 'üìâ 100+ USD KURS: 14,500', type: 'header'},
                {name: 'üí≤ 100 USD', price: '1 450 000'},
                {name: 'üí≤ 500 USD', price: '7 250 000'},
                {name: 'üí≤ 1000 USD', price: '14 500 000'}
            ],

            'PUBG Mobile': [
                {name: "‚ö†Ô∏è UC ID orqali tashlab beriladi! Shuning uchun narxlar biroz qimmat bo'lishi mumkin!", type: 'header'},
                {name: '60 UC', price: '15 000'},
                {name: '325 UC', price: '63 000'},
                {name: '660 UC', price: '126 000'},
                {name: '1800 UC', price: '322 000'},
                {name: '3850 UC', price: '638 000'},
                {name: '8100 UC', price: '1 265 000'}
            ],
            
            'Telegram Gifts': [
                {name: '‚≠êÔ∏è 15 Stars', type: 'header'},
                {name: 'üß∏ Teddy', price: '4 000'},
                {name: 'üíù Valentine box', price: '4 000'},
                
                {name: '‚≠êÔ∏è 25 Stars', type: 'header'},
                {name: 'üéÅ Gift box', price: '6 000'},
                {name: 'üåπ Rose', price: '6 000'},
                
                {name: '‚≠êÔ∏è 50 Stars', type: 'header'},
                {name: 'üéÇ Cake', price: '13 000'},
                {name: 'üöÄ Raketa', price: '13 000'},
                
                {name: '‚≠êÔ∏è 100 Stars', type: 'header'},
                {name: 'üíé Diamond', price: '17 000'},
                {name: 'üèÜ Kubok', price: '17 000'}
            ],

            'default': [
                {name: 'Kichik Paket', price: '15 000'},
                {name: 'O\'rta Paket', price: '45 000'}
            ]
        };

        let selectedItem = null;
        let selectedPackage = null;

        function openDetail(title, inputType) {
            document.getElementById('detailTitle').innerText = title;
            selectedItem = title;
            selectedPackage = null;
            document.getElementById('buyBtn').classList.remove('active');
            document.getElementById('userIdInput').value = '';
            document.getElementById('commentInput').value = ''; 
            document.getElementById('anonymousCheckbox').checked = false; // Checkboxni tozalash

            const label = document.getElementById('inputLabel');
            const commentGroup = document.getElementById('commentGroup');
            const anonymousGroup = document.getElementById('anonymousGroup');
            
            if (inputType === 'username') label.innerText = "Telegram Username (@...)";
            else if (inputType === 'tag') label.innerText = "Player Tag (#ABC)";
            else if (inputType === 'login') label.innerText = "Steam Login";
            else label.innerText = "ID Raqamingiz";

            if (title === 'Telegram Gifts') {
                packageLabel.innerText = "Giftni tanlang:";
                commentGroup.style.display = 'block'; 
                anonymousGroup.style.display = 'flex'; // Anonim tugmasi ko'rinadi
            } else if (title === 'Telegram Premium' || title === 'Telegram Stars') {
                packageLabel.innerText = "Taklifni tanlang:";
                commentGroup.style.display = 'none'; 
                anonymousGroup.style.display = 'none';
            } else {
                packageLabel.innerText = "Paketni tanlang:";
                commentGroup.style.display = 'none'; 
                anonymousGroup.style.display = 'none';
            }

            const container = document.getElementById('packagesContainer');
            
            if (title === 'Telegram Premium' || title === 'Steam Wallet' || title === 'PUBG Mobile' || title === 'Telegram Gifts') {
                container.style.gridTemplateColumns = "1fr"; 
            } else {
                container.style.gridTemplateColumns = "1fr 1fr"; 
            }
            
            container.innerHTML = '';
            
            const list = products[title] || products['default'];
            list.forEach(pkg => {
                if (pkg.type === 'header') {
                    const div = document.createElement('div');
                    div.className = 'package-header';
                    div.innerText = pkg.name;
                    container.appendChild(div);
                    return;
                }

                const btn = document.createElement('div');
                let cssClass = 'package-btn';
                if (pkg.full) cssClass += ' full-width';
                btn.className = cssClass;

                btn.innerHTML = `<div>${pkg.name}</div><span class="package-price">${pkg.price} so'm</span>`;
                btn.onclick = () => selectPackage(btn, pkg);
                container.appendChild(btn);
            });

            screenDetail.style.transform = "translateX(0%)";
        }

        function closeDetail() {
            screenDetail.style.transform = "translateX(100%)";
        }

        function selectPackage(btn, pkg) {
            document.querySelectorAll('.package-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            selectedPackage = pkg;
            checkButton();
        }

        const userIdInput = document.getElementById('userIdInput');
        userIdInput.addEventListener('input', checkButton);

        function checkButton() {
            const btn = document.getElementById('buyBtn');
            let inputValue = userIdInput.value.trim(); 
            let isValid = false;

            if (selectedItem === 'Telegram Premium' || selectedItem === 'Telegram Stars' || selectedItem === 'Telegram Gifts') {
                if (inputValue.startsWith('@') && inputValue.length >= 5) {
                    isValid = true;
                }
            } else {
                if (inputValue.length > 2) {
                    isValid = true;
                }
            }

            if (selectedPackage && isValid) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        }

        function sendOrder() {
            if (!selectedPackage) return;
            const data = JSON.stringify({
                game: selectedItem,
                id: userIdInput.value,
                pack: selectedPackage.name,
                price: selectedPackage.price,
                comment: document.getElementById('commentInput').value.trim(),
                is_anonymous: document.getElementById('anonymousCheckbox').checked // Anonim holatini yuborish
            });
            tg.sendData(data); 
        }
    </script>
</body>
</html>